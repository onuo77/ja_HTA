-- employees 테이블에서 사원들의 모든 업무아이디를 조회하기
select distinct job_id
from employees;

-- 급여를 12,000달러 이상 받는 사원의 이름과 급여를 조회하기
select first_name, salary
from employees
where salary >= 12000;

-- 사원번호가 176번 사원의 아이디와 이름 직종을 조회하기
select employee_id, job_id 
from employees 
where employee_id = 176;

-- 급여를 12,000달러 이상 15,000달러 이하 받는 사원들의 사원 아이디와 이름과 급여를 조회하기
select employee_id, first_name, salary 
from employees 
where salary >= 12000 and salary <= 15000;

--  2000년 1월 1일부터 2000년 6월 30일 사이에 입사한 사원의 아이디, 이름, 업무아이디, 입사일을 조회하기
select employee_id, first_name, job_id, hire_date 
from employees 
where hire_date >= to_date('2000/01/01') and hire_date < to_date('2000/07/01');

-- 급여가 5,000달러와 12,000달러 사이이고, 부서번호가 20 또는 50인 사원의 이름과 급여를 조회하기
select first_name, salary 
from employees 
where salary >= 5000 and salary <= 12000 
and department_id in (20, 50);

-- 관리자가 없는 사원의 이름과 업무아이디를 조회하기
select first_name, job_id 
from employees 
where manager_id is null;

-- 커미션을 받는 모든 사원의 이름과 급여, 커미션을 급여 및 커미션의 내림차순으로 정렬해서 조회하기
select first_name, salary, commission_pct
from employees 
where commission_pct is not null
order by salary desc, commission_pct desc;

-- 이름의 2번째 글자가 e인 모든 사원의 이름을 조회하기
select first_name 
from employees 
where first_name like '_a%';

-- 업무아이디가 ST_CLERK 또는 SA_REP이고 급여를 2,500달러, 3,500달러, 7,000달러 받는 모든 사원의 이름과 업무아이디, 급여를 조회하기
select first_name, job_id, salary 
from employees 
where job_id in ('ST_CLERK', 'SA_REP')
and salary in (2500, 3500, 7000);

-- 모든 사원의 이름과 입사일, 근무 개월 수를 계산하여 조회하기, 근무개월 수는 정수로 반올림하고, 근무개월수를 기준으로 오름차순으로 정렬하기
select first_name, hire_date, round(months_between(sysdate, hire_date)) months
from employees 
order by months;

-- 사원의 이름과 커미션을 조회하기, 커미션을 받지 않는 사원은 '없음'으로 표시하기
select first_name, nvl(to_char(commission_pct, '0.99'), '없음') commission
from employees;

-- 모든 사원의 이름, 부서번호, 부서이름을 조회하기
select E.first_name, D.department_id, D.department_name 
from employees E, departments D 
where E.department_id = D.department_id;

-- 80번부서에 소속된 사원의 이름과 업무아이디, 업무제목, 부서이름을 조회하기
select E.first_name, J.job_id, J.job_title, D.department_name 
from employees E, jobs J, departments D 
where E.department_id = 80
and E.job_id = J.job_id 
and E.department_id = D.department_id;

-- 커미션을 받는 모든 사원의 이름과 업무아이디, 업무제목, 부서이름, 부서소재지 도시명을 조회하기
select E.first_name, E.job_id, J.job_title, D.department_name, L.city
from employees E, jobs J, departments D, locations L 
where E.commission_pct is not null 
and E.job_id = J.job_id 
and E.department_id = D.department_id 
and D.location_id = L.location_id;

-- 유럽에 소재지를 두고 있는 모든 부서아이디와 부서이름을 조회하기
select D.department_id, D.department_name 
from departments D, locations L, countries C, regions R 
where R.region_name = 'Europe'
and D.location_id = L.location_id 
and L.country_id = C.country_id
and C.region_id = R.region_id;

-- 사원의 이름과 소속부서명, 급여, 급여 등급을 조회하기
select E.first_name, D.department_name, E.salary, G.grade 
from employees E, departments D, salary_grade G 
where E.department_id = D.department_id(+)
and E.salary >= G.min_salary and E.salary <= G.max_salary;

-- 사원의 이름과 소속부서명, 소속부서의 관리자명을 조회하기, 소속부서가 없는 사원은 소속부서명 '없음, 관리자명 '없음'으로 표시하기
select E.first_name, nvl(D.department_name, '없음') department_name, nvl(M.first_name, '없음') manager_name
from employees E, departments D, employees M 
where E.department_id = D.department_id(+)
and D.manager_id = M.employee_id(+)
order by E.employee_id asc;

-- 모든 사원의 급여 최고액, 급여 최저액, 급여 총액, 급여 평균액을 조회하기
select max(salary) max_salary, min(salary) min_salary, sum(salary) sum_salary, trunc(avg(salary)) avg_salary
from employees;

-- 업무별 급여 최고액, 급여 최저액, 급여 총액, 급여 평균액을 조회하기
select job_id, max(salary) max_salary, min(salary) min_salary, sum(salary) sum_salary, trunc(avg(salary)) avg_salary
from employees
group by job_id;

-- 각 업무별 사원수를 조회해서 가장 사원수가 많은 업무 3개를 조회하기, 업무아이디와 사원수 표시하기
with employees_count_by_job_id 
as (
    select job_id, count(*) cnt 
    from employees
    group by job_id
)
select job_id, cnt 
from (select job_id, cnt
           from employees_count_by_job_id
           order by cnt desc)
where rownum <= 3;

-- 관리자별 사원수를 조회하기, 관리자 이름과 그 관리자가 관리하는 사원수 표시하기
select E.first_name, X.cnt
from (select manager_id, count(*) cnt 
           from employees 
           where manager_id is not null
           group by manager_id) X, employees E
where X.manager_id = E.employee_id;

-- 각 부서에 대해 부서이름, 관리자 이름, 소속사원 수, 소속사원들의 평균 급여를 조회하기
select D.department_name, M.first_name, X.cnt, X.avg_salary 
from (select department_id, count(*) cnt , trunc(avg(salary)) avg_salary
           from employees 
           group by department_id) X, departments D, employees M 
where X.department_id = D.department_id
and D.manager_id = M.employee_id;

-- Steven King과 같은 부서에 속한 사원의 이름과 입사일을 조회하기
select first_name, hire_date
from employees 
where department_id in (select department_id 
                                             from employees 
                                             where first_name = 'Steven'
                                             and last_name = 'King');

-- 소속 부서의 평균급여보다 많은 급여를 받는 사원의 아이디와 사원이름, 급여, 
-- 그 부서의 평균 급여를 조회하기
select E.employee_id, E.first_name, E.salary, trunc(X.avg_salary) avg_salary 
from employees E, (select department_id, avg(salary) avg_salary
                   from employees 
                   group by department_id) X 
where E.department_id = X.department_id 
and E.salary > X.avg_salary;

-- Kochhar과 동일한 급여 및 커미션을 받는 모든 사원의 이름과 입사일 급여를 조회하기, 
-- 결과에 Kochhar은 포함시키지 않기
select first_name, hire_date, salary 
from employees 
where (salary, commission_pct) in (select salary, commission_pct 
                                   from employees 
                                   where last_name = 'Kochhar')
and last_name <> 'Kochhar';

-- 소속 부서의 관리자보다 입사일이 늦지만, 더 많은 급여를 받는 사원의 이름과 
--소속부서명, 급여를 조회하기
select E.employee_id, E.first_name, D.department_name, E.salary
from employees E, departments D, employees M 
where E.department_id = D.department_id 
and D.manager_id = M.employee_id 
and E.hire_date > M.hire_date 
and E.salary > M.salary;

-- 부서 관리자 아이디, 관리자명, 그 관리자가 관리하는 사원수, 
-- 그 관리자가 소속된 부서를 조회하기
select D.department_id, D.department_name, M.employee_id, M.first_name, 
      (select count(*) from employees X where X.manager_id = M.employee_id) emp_cnt
from employees M, departments D 
where D.manager_id = M.employee_id
order by D.department_id;

